<% content_for :title, @event.name %>
<% content_for :back_url, expense_events_url %>
<% content_for :actions do %>
  <li>
    <a href="<%= expense_event_invite_url(@event) %>" class="dropdown-item">Invite</a>
  </li>
  <li>
    <a href="<%= edit_expense_event_url(@event) %>" class="dropdown-item">Edit</a>
  </li>
  <li>
    <%= form_with model: @event do |form| %>
      <%= form.button "Delete", formmethod: :delete, data: { confirm: "⚠️ Are you sure want to delete event `#{@event.name}`?" }, class: 'dropdown-item' %>
    <% end %>
  </li>
<% end %>

<div class="d-flex justify-content-around mb-4 text-center">
  <div>
    <div class="fs-7 fw-light text-secondary">My Expenses</div>
    <div class="fw-semibold"><%= format_monetary(total_my_expenses) %></div>
  </div>
  <div>
    <div class="fs-7 fw-light text-secondary">Total Expenses</div>
    <div class="fw-semibold"><%= format_monetary(total_expenses) %></div>
  </div>
</div>

<div class="d-flex flex-column gap-4">
  <% @items.each_pair do |paid_on, items| %>
    <div>
      <div class="mb-2 fw-semibold"><%= paid_on.strftime('%e %b %Y') %></div>
      <div class="d-flex flex-column gap-2">
        <% items.each do |item| %>
          <a href="<%= expense_event_expense_item_url(@event, item) %>" class="link-underline link-underline-opacity-0" style="color: initial">
            <div class="py-2 px-3 d-flex justify-content-between align-items-center bg-light rounded rounded-2">
              <div class="flex flex-column gap-2 flex-grow-1">
                <div><%= item.name %></div>
                <div class="text-secondary fs-7 fw-semibold">
                  <span class="fw-light">Paid by</span> <%= item.paid_by.participant_name %>
                </div>
              </div>
              <div class="fw-bolder"><%= format_monetary(item.amount) %></div>
            </div>
          </a>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<div id="add-expense-btn">
  <a href="<%= new_expense_event_expense_item_url(@event) %>" class="add-expense-btn-icon link-underline link-underline-opacity-0">
    <i class="bi bi-plus"></i>
  </a>
  <div class="px-1 fw-bolder text-primary bg-primary-subtle rounded small">
    Add expense
  </div>
</div>

<style>
  #add-expense-btn {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    cursor: pointer;
    transform: translateX(-50%);

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 0.25rem;
  }

  #add-expense-btn .add-expense-btn-icon {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 3rem;
    height: 3rem;

    border-radius: 50%;
    border: 1px solid var(--bs-primary);
    background-color: var(--bs-primary-bg-subtle);
  }

  #add-expense-btn i {
    color: var(--bs-primary);
    font-size: 2rem;
  }
</style>

